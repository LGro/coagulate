stages:
  - build
# - test

.macos_saas_runners:
  tags:
    - saas-macos-medium-m1
  image: macos-12-xcode-14
  before_script:
    - echo "started by ${GITLAB_USER_NAME}"

build:
  extends:
    - .macos_saas_runners
  stage: build
  script:
    - echo "place holder for build"
    - git clone https://gitlab.com/veilid/veilid.git ../veilid
    - curl –proto ‘=https’ –tlsv1.2 -sSf https://sh.rustup.rs | sh
    - sudo -H -u $BREW_USER brew install capnp cmake wabt llvm protobuf openjdk@17 jq
    - cargo install wasm-bindgen-cli wasm-pack cargo-edit
    - sudo gem install cocoapods
    - wget -P /Downloads https://storage.googleapis.com/flutter_infra_release/releases/stable/macos/flutter_macos_3.13.5-stable.zip
    - unzip ~/Downloads/flutter_macos_3.13.5-stable.zip -d /Downloads && export PATH="$PATH:Downloads/flutter/bin"
    - yes | flutter doctor --android-licenses
    - ../veilid/veilid-flutter/setup_flutter.sh

#test:
#  extends:
#    - .macos_saas_runners
#  stage: test
#  script:
#    - echo "place holder for test"

